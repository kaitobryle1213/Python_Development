{% extends 'Payment_Scheduler/base.html' %}
{% load form_tags %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-6 col-lg-5">
        <div class="card border-0 shadow-sm">
            <div class="card-header bg-white border-bottom py-3">
                <h5 class="card-title mb-0 fw-bold">{{ title }}</h5>
            </div>
            <div class="card-body p-4">
                <form method="post" id="room-form">
                    {% csrf_token %}
                    
                    {% for field in form %}
                    {# Wrap the capacity field in a div so we can hide/show it via JS #}
                    <div class="mb-3 {% if field.name == 'capacity' %}capacity-wrapper{% endif %}" 
                         {% if field.name == 'capacity' %}id="capacity-field-group" style="display: none;"{% endif %}>
                        
                        <label for="{{ field.id_for_label }}" class="form-label small text-secondary fw-medium">
                            {{ field.label }}
                        </label>
                        
                        {# Ensure the field has the form-control class for styling #}
                        <div class="input-group">
                            <span class="input-group-text"><i class="fas {{ field.name|get_icon }}"></i></span>
                            {{ field }}
                        </div>
                        
                        {% if field.errors %}
                        <div class="invalid-feedback d-block">
                            {{ field.errors.0 }}
                        </div>
                        {% endif %}
                        
                        {% if field.name == 'capacity' %}
                        <div id="capacity-help" class="form-text small">Define how many people can stay in this bed spacer room.</div>
                        {% endif %}
                    </div>
                    {% endfor %}

                    <div class="d-flex justify-content-end gap-2 mt-4">
                        <a href="{% url 'rooms' %}" class="btn btn-light text-secondary">Cancel</a>
                        <button type="submit" class="btn btn-primary px-4">Save Room</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        // IDs are generated by Django as id_fieldname
        const typeSelect = document.querySelector('[name="room_type"]');
        const capacityGroup = document.getElementById('capacity-field-group');
        const capacityInput = document.querySelector('[name="capacity"]');

        function handleTypeChange() {
            // Check if the selected text or value matches "Bed Spacer"
            // Note: Value check is case-sensitive based on your model choices
            if (typeSelect.value === 'Bed Spacer') {
                capacityGroup.style.display = 'block';
            } else {
                capacityGroup.style.display = 'none';
                // If "Single", we force the value to 1
                if (typeSelect.value === 'Single') {
                    capacityInput.value = 1;
                }
            }
        }

        // Initialize on page load (important for Edit mode)
        if (typeSelect && capacityGroup) {
            handleTypeChange();
            // Listen for changes
            typeSelect.addEventListener('change', handleTypeChange);
        }
    });
</script>
{% endblock %}